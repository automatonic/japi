box: microsoft/dotnet
build:
  steps:
    - script:
        name: dotnet restore
        code: |
          dotnet restore
    - script:
        name: dotnet test 
        code: |
          dotnet test /pipeline/source/test/JApi.Should/project.json -c Release
    - script:
        name: dotnet pack 
        code: |
          dotnet pack /pipeline/source/src/JApi/project.json -c Release
          
push:
  steps:
    - script: 
        name: add runtimeconfig for nuget xplat
        code: |
          printf "{\"runtimeOptions\":{\"framework\":{\"name\": \"Microsoft.NETCore.App\",\"version\": \"1.0.0\"}}}" > /usr/share/dotnet/sdk/$DOTNET_SDK_VERSION/NuGet.CommandLine.XPlat.runtimeconfig.json
    - script:
        name: nuget push
        code: |
          dotnet /usr/share/dotnet/sdk/$DOTNET_SDK_VERSION/NuGet.CommandLine.XPlat.dll push /pipeline/source/src/JApi/bin/Release/JApi.0.1.0.nupkg $NUGET_API_KEY -Source https://www.nuget.org/api/v2/package 